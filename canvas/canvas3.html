<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        *{margin:0;padding:0}
    </style>
</head>
<body>
<canvas id="cvs" width="730" height="454">canvas</canvas>
<img src="images1/4.jpg" id="img" />

</body>
</html>
<script>
   // window.onload=function(){
        var cvs=document.getElementById("cvs");
        var ctx=cvs.getContext("2d");
        var img=document.getElementById("img");
        ctx.drawImage(img,0,0);// 先画图 在获取图片
        var imgdata=ctx.getImageData(0,0,cvs.width,cvs.height);

        for(var x=0;x<imgdata.width;x++){
            for(var y=0;y<imgdata.height;y++){
                var index=(x+y*imgdata.width)*4 ;
                var r=imgdata.data[index+0];
                var g=imgdata.data[index+1];
                var b=imgdata.data[index+2];
                var a=imgdata.data[index+3];

                var avg=(r+g+b)/3;

                //imgdata.data[index+3]=50;
                /*
                 imgdata.data[index+0]=g;
                 imgdata.data[index+1]=b;
                 imgdata.data[index+2]=a;
                 */
                imgdata.data[index+0]=avg;
                imgdata.data[index+1]=avg;
                imgdata.data[index+2]=avg;
            }
        };
        //ctx.putImageData(imgdata,730,454)
        ctx.putImageData(imgdata,0,0)


   // }


</script>
